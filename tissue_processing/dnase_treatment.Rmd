---
title: "dnase_treatment"
output:
  html_document: default
  pdf_document: default
date: "2025-08-27"
---

DNase treatment of extracted RNA prior to sending to novogene for RNA-seq.

```{r load libraries}
# library
library(tidyverse)
```

# Gill samples for sequencing

We've been uploading extraction information into `genetics_processing_tracker.csv'. I want to load this file and filter for gill samples (and for replicates that we've selected to sequence).

```{r load processing csv}
# load df
df <- read.csv('~/Documents/CE_ORCC/2024/genetics/genetics_processing_tracker.csv')

# filtering df...
gill_df <- df %>%
  # ... for gill tissue
  filter(Tissue == 'gill') %>%
  # and selecting only the RNA columns 
  select(c(1:2,11:17, 21))

head(gill_df)
```

# Assigning good or bad RNA
Based on the absorbance ratios - "good" RNA have 260/280 and 260/230 values > 2.0 and are good to go for sequencing - can proceed directly to the DNase treatment. 

Creating a new column, `QC_pass`, to keep track of which samples will pass QC or not. 
- Y = yes passes QC - both absorbance ratios are above 2.0
- K = kinda passes QC - only the 260/280 ratio is above 2.0 (as long as qubit conc. is okay, sample will most likely move on for sequencing)
- N = no, doesn't pass QC - both absorbance ratios are below 2.0 


```{r QC assignment}
rna <- rna %>%
  mutate(QC_pass = case_when(
    RNA_260.280 >= 2 & RNA_260.230 >= 2 ~ 'Y',
    RNA_260.280 >= 2 & RNA_260.230 < 2  ~ 'K',
    TRUE                                ~ 'N'
  ))

```


### calculating dilution volumes
For sequencing, I'm aiming to submit samples that are 100ng/uL in 20uL. 
  Formula: *M1V1 = M2V2*

```{r diluting samples}

# assigning M2 and V2
want_conc <- 100 # 100ng/uL
want_vol <- 20 # 20uL

# amount of sample needed
rna$sample_100ng.ul <- round(((want_conc * want_vol)/rna$RNA_ng.uL), 2)

# amount of water needed
rna$water_100ng.ul <- want_vol - rna$sample_100ng.ul

head(rna)
```

For any samples that have an initial concentration below 100ng/uL, then 20uL of sample will be taken (and 0uL of H2O) for the DNase treatment

```{r samples below 100ng/uL}
# if samples have a conc. below 100ng/uL...

# ... take 20uL of sample
rna$sample_100ng.ul <- ifelse(rna$RNA_ng.uL <= 100,
                                   20,
                                   rna$sample_100ng.ul)
# ... don't add water
rna$water_100ng.ul <- ifelse(rna$RNA_ng.uL <= 100,
                                  0,
                                  rna$water_100ng.ul)

head(rna)

```

Add column of final concentration

```{r final conc. column}
# if you're adding water, that means the OG sample conc. is >100
rna$seq_conc <- ifelse(rna$water_100ng.ul > 0,
                       # so the final conc. is going to be 100
                       100,
                       # if not, the final conc. is the same as the OG 
                       rna$RNA_ng.uL)

head(rna)
```


```{r add columns for processing}
rna$dnase_treat <- ''
rna$dnase_freezer <- ''
rna$dnase_rack <- ''
rna$dnase_box <- ''
```

make new csv to keep track of dnase treatment processing
```{r write csv}
write.csv(rna, '~/Documents/CE24_RNA-seq/tissue_processing/dnase_treat_tracker.csv', row.names=FALSE)
```




